<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.552">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<meta name="author" content="Rafael Belokurows">
<meta name="dcterms.date" content="2024-05-15">
<meta name="description" content="Obtain daily weather data for weather stations all over the world with a few lines of code + some plots to get you started">
<title>Rafael Belokurows - Worlwide Weather Data</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>

<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../../site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark"><script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script><script src="../../site_libs/htmlwidgets-1.6.2/htmlwidgets.js"></script><script src="../../site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><link href="../../site_libs/leaflet-1.3.1/leaflet.css" rel="stylesheet">
<script src="../../site_libs/leaflet-1.3.1/leaflet.js"></script><link href="../../site_libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet">
<script src="../../site_libs/proj4-2.6.2/proj4.min.js"></script><script src="../../site_libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script><link href="../../site_libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet">
<script src="../../site_libs/leaflet-binding-2.2.0/leaflet.js"></script><link rel="stylesheet" href="../../styles.css">
</head>
<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner"><nav class="navbar navbar-expand-lg " data-bs-theme="dark"><div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Rafael Belokurows</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
<li class="nav-item">
    <a class="nav-link" href="../../index.html"> <i class="bi bi-house-door-fill" role="img">
</i> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../projects.html"> <i class="bi bi-card-checklist" role="img">
</i> 
<span class="menu-text">Projects</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../resume.html"> <i class="bi bi-file-earmark-person" role="img">
</i> 
<span class="menu-text">Resume</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../blog.html"> <i class="bi bi-pen-fill" role="img">
</i> 
<span class="menu-text">Blog</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../data-viz.html"> <i class="bi bi-graph-up-arrow" role="img">
</i> 
<span class="menu-text">Data Viz</span></a>
  </li>  
</ul>
<ul class="navbar-nav navbar-nav-scroll ms-auto">
<li class="nav-item compact">
    <a class="nav-link" href="https://github.com/rafabelokurows"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://www.linkedin.com/in/rafabelo"> <i class="bi bi-linkedin" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
</div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav></header><!-- content --><header id="title-block-header" class="quarto-title-block default page-columns page-full"><div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Worlwide Weather Data</h1>
                  <div>
        <div class="description">
          Obtain daily weather data for weather stations all over the world with a few lines of code + some plots to get you started
        </div>
      </div>
                          <div class="quarto-categories">
                <div class="quarto-category">R</div>
                <div class="quarto-category">weather</div>
                <div class="quarto-category">packages</div>
                <div class="quarto-category">geo</div>
                <div class="quarto-category">data</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Rafael Belokurows </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">May 15, 2024</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">On this page</h2>
   
  <ul>
<li><a href="#obtaining-the-data" id="toc-obtaining-the-data" class="nav-link active" data-scroll-target="#obtaining-the-data">Obtaining the data</a></li>
  <li>
<a href="#plots" id="toc-plots" class="nav-link" data-scroll-target="#plots">Plots</a>
  <ul class="collapse">
<li><a href="#example-1-temperature-as-lines" id="toc-example-1-temperature-as-lines" class="nav-link" data-scroll-target="#example-1-temperature-as-lines">Example 1: Temperature as lines</a></li>
  <li><a href="#example-2-rainy-days-by-season" id="toc-example-2-rainy-days-by-season" class="nav-link" data-scroll-target="#example-2-rainy-days-by-season">Example 2: Rainy Days By Season</a></li>
  <li><a href="#example-3-horizon-plots-to-visualize-temperature-changes-over-the-years" id="toc-example-3-horizon-plots-to-visualize-temperature-changes-over-the-years" class="nav-link" data-scroll-target="#example-3-horizon-plots-to-visualize-temperature-changes-over-the-years">Example 3: Horizon Plots to visualize temperature changes over the years</a></li>
  </ul>
</li>
  </ul></nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content"><p>Hello, Data people!</p>
<p>In this post, I’ll show you a great source of daily weather data for your ML projects or personal needs.</p>
<p>I’m talking about R package <code>GSODR</code> which facilitates obtaining data from the NOAA’s Global Summary of the Day (GSOD). The GSOD is a summary of daily weather conditions based on underlying hourly data points measured at more than 9,000 global weather stations.<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> Check out <a href="https://www.ncei.noaa.gov/access/metadata/landing-page/bin/iso?id=gov.noaa.ncdc:C00516">NOAA’s webpage</a> fore more details on it.</p>
<p>Some of the weather features available include, for each day:</p>
<ul>
<li>Average, Maximum and Minimum temperature in ºC degrees.</li>
<li>Amount of precipitation in mm.</li>
<li>Relative Humidity in %</li>
<li>Occurrence of many weather ‘features’ such as fog, snow, hail, thunder and even tornadoes</li>
</ul>
<p>For an exhaustive list of all the features available, check <a href="https://cran.r-project.org/web/packages/GSODR/vignettes/GSODR.html">here</a>.</p>
<section id="obtaining-the-data" class="level2"><h2 class="anchored" data-anchor-id="obtaining-the-data">Obtaining the data</h2>
<p>GSODR is available on CRAN, so installing it is as easy as <code>install.packages("GSODR")</code>.</p>
<p>Let’s find if a particular place has some weather stations near by. First, when you install the package, it stores a list of stations in a local database, from there, you can look up a country or a place (station name).</p>
<div class="cell">
<details open="" class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://docs.ropensci.org/GSODR/">GSODR</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/load.html">load</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"isd_history.rda"</span>, package <span class="op">=</span> <span class="st">"GSODR"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">isd_history</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">COUNTRY_NAME</span> <span class="op">==</span> <span class="st">"CANADA"</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu">select</span><span class="op">(</span><span class="va">STNID</span>,<span class="va">NAME</span>,<span class="va">LAT</span>,<span class="va">LON</span>,<span class="va">COUNTRY_NAME</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span>  <span class="fu">gt</span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div>
<div id="nfsmdtfbtl" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#nfsmdtfbtl table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#nfsmdtfbtl thead, #nfsmdtfbtl tbody, #nfsmdtfbtl tfoot, #nfsmdtfbtl tr, #nfsmdtfbtl td, #nfsmdtfbtl th {
  border-style: none;
}

#nfsmdtfbtl p {
  margin: 0;
  padding: 0;
}

#nfsmdtfbtl .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#nfsmdtfbtl .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#nfsmdtfbtl .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#nfsmdtfbtl .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#nfsmdtfbtl .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#nfsmdtfbtl .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#nfsmdtfbtl .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#nfsmdtfbtl .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#nfsmdtfbtl .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#nfsmdtfbtl .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#nfsmdtfbtl .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#nfsmdtfbtl .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#nfsmdtfbtl .gt_spanner_row {
  border-bottom-style: hidden;
}

#nfsmdtfbtl .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#nfsmdtfbtl .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#nfsmdtfbtl .gt_from_md > :first-child {
  margin-top: 0;
}

#nfsmdtfbtl .gt_from_md > :last-child {
  margin-bottom: 0;
}

#nfsmdtfbtl .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#nfsmdtfbtl .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#nfsmdtfbtl .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#nfsmdtfbtl .gt_row_group_first td {
  border-top-width: 2px;
}

#nfsmdtfbtl .gt_row_group_first th {
  border-top-width: 2px;
}

#nfsmdtfbtl .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#nfsmdtfbtl .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#nfsmdtfbtl .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#nfsmdtfbtl .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#nfsmdtfbtl .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#nfsmdtfbtl .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#nfsmdtfbtl .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#nfsmdtfbtl .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#nfsmdtfbtl .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#nfsmdtfbtl .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#nfsmdtfbtl .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#nfsmdtfbtl .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#nfsmdtfbtl .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#nfsmdtfbtl .gt_left {
  text-align: left;
}

#nfsmdtfbtl .gt_center {
  text-align: center;
}

#nfsmdtfbtl .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#nfsmdtfbtl .gt_font_normal {
  font-weight: normal;
}

#nfsmdtfbtl .gt_font_bold {
  font-weight: bold;
}

#nfsmdtfbtl .gt_font_italic {
  font-style: italic;
}

#nfsmdtfbtl .gt_super {
  font-size: 65%;
}

#nfsmdtfbtl .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#nfsmdtfbtl .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#nfsmdtfbtl .gt_indent_1 {
  text-indent: 5px;
}

#nfsmdtfbtl .gt_indent_2 {
  text-indent: 10px;
}

#nfsmdtfbtl .gt_indent_3 {
  text-indent: 15px;
}

#nfsmdtfbtl .gt_indent_4 {
  text-indent: 20px;
}

#nfsmdtfbtl .gt_indent_5 {
  text-indent: 25px;
}
</style>
<table class="gt_table table table-sm table-striped small" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead><tr class="header gt_col_headings">
<th id="STNID" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">STNID</th>
<th id="NAME" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col">NAME</th>
<th id="LAT" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">LAT</th>
<th id="LON" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">LON</th>
<th id="COUNTRY_NAME" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col">COUNTRY_NAME</th>
</tr></thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_right" headers="STNID">693840-99999</td>
<td class="gt_row gt_left" headers="NAME">BOW DRILL</td>
<td class="gt_row gt_right" headers="LAT">44.000</td>
<td class="gt_row gt_right" headers="LON">-59.333</td>
<td class="gt_row gt_left" headers="COUNTRY_NAME">CANADA</td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers="STNID">693850-99999</td>
<td class="gt_row gt_left" headers="NAME">GLOMAR HIGH ISLAND</td>
<td class="gt_row gt_right" headers="LAT">47.167</td>
<td class="gt_row gt_right" headers="LON">-62.833</td>
<td class="gt_row gt_left" headers="COUNTRY_NAME">CANADA</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="STNID">693860-99999</td>
<td class="gt_row gt_left" headers="NAME">DRURY CREEK</td>
<td class="gt_row gt_right" headers="LAT">62.200</td>
<td class="gt_row gt_right" headers="LON">-134.383</td>
<td class="gt_row gt_left" headers="COUNTRY_NAME">CANADA</td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers="STNID">693870-99999</td>
<td class="gt_row gt_left" headers="NAME">CARMACKS</td>
<td class="gt_row gt_right" headers="LAT">62.117</td>
<td class="gt_row gt_right" headers="LON">-136.183</td>
<td class="gt_row gt_left" headers="COUNTRY_NAME">CANADA</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="STNID">693880-99999</td>
<td class="gt_row gt_left" headers="NAME">KLONDIKE</td>
<td class="gt_row gt_right" headers="LAT">64.450</td>
<td class="gt_row gt_right" headers="LON">-138.217</td>
<td class="gt_row gt_left" headers="COUNTRY_NAME">CANADA</td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers="STNID">693900-99999</td>
<td class="gt_row gt_left" headers="NAME">SHELDON LAKE</td>
<td class="gt_row gt_right" headers="LAT">62.617</td>
<td class="gt_row gt_right" headers="LON">-131.267</td>
<td class="gt_row gt_left" headers="COUNTRY_NAME">CANADA</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<p>TIP: It’s a good practice to run <code><a href="https://rdrr.io/pkg/GSODR/man/update_station_list.html">GSODR::update_station_list()</a></code> every once in a while to force-update the list of weather stations available.</p>
<p>It’s pretty easy to plot an interactive map of the weather stations that we just identified:</p>
<div class="cell">
<details open="" class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb2"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">leaflet</span><span class="op">(</span>data <span class="op">=</span> <span class="va">isd_history</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">COUNTRY_NAME</span> <span class="op">==</span> <span class="st">"CANADA"</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>          <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html">grepl</a></span><span class="op">(</span><span class="st">"GRATES COVE"</span>,<span class="va">NAME</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu">sample_n</span><span class="op">(</span><span class="fl">100</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu">addTiles</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">addMarkers</span><span class="op">(</span><span class="op">~</span><span class="va">LON</span>, <span class="op">~</span><span class="va">LAT</span>, popup <span class="op">=</span> <span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="va">NAME</span><span class="op">)</span>, label <span class="op">=</span> <span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="va">NAME</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div class="leaflet html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-19878c7d8f82fee88457" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-19878c7d8f82fee88457">{"x":{"options":{"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}}},"calls":[{"method":"addTiles","args":["https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",null,null,{"minZoom":0,"maxZoom":18,"tileSize":256,"subdomains":"abc","errorTileUrl":"","tms":false,"noWrap":false,"zoomOffset":0,"zoomReverse":false,"opacity":1,"zIndex":1,"detectRetina":false,"attribution":"&copy; <a href=\"https://openstreetmap.org/copyright/\">OpenStreetMap<\/a>,  <a href=\"https://opendatacommons.org/licenses/odbl/\">ODbL<\/a>"}]},{"method":"addMarkers","args":[[52.283,47.967,69.18300000000001,50.63,52.333,72.767,42.25,63.6,56.3,67.06999999999999,45.05,45.117,80,61.917,53.867,49.167,50.79,49.983,50.217,42.43,69.083,54.16,53.5,53.683,50.333,43.55,64.18300000000001,53.917,54.25,50.3,53.25,46.35,54.983,61.317,59.22,50.65,45.067,52.583,51.367,75.717,49.517,50.45,49.167,49.283,50.267,49.783,48.417,50.167,60.85,51.617,49.917,56.867,54.633,46.364,51.767,52.55,53.65,60.817,49.867,49.083,49.1,58.917,57.35,54.017,47.617,47.8,45.317,50.55,50.233,58.333,54.167,49.617,53.85,45.367,49.033,81.33,53.15,53.309,60.017,50.233,53.717,49.783,45.95,53.668,45.883,44.881,48.533,49.183,49.017,47.017,43.95,52.067,45.633,69.547,49.833,63.616,44.217,49.183,60.767,51.433],[-111.1,-84.78700000000001,-122.35,-128.12,-112.583,-118.5,-81.90000000000001,-105.133,-119.733,-121.1,-72.84999999999999,-74.283,-85.93300000000001,-113.717,-94.667,-105.983,-96.73,-110.267,-64.2,-82.68000000000001,-79.033,-134.28,-130.633,-112.867,-127.967,-80.217,-114.083,-112.267,-133.05,-122.733,-131.817,-72.5,-85.43300000000001,-117.6,-109.7,-128,-73.81699999999999,-111.467,-55.633,-98.417,-114,-59.633,-105.967,-100.983,-107.733,-94.367,-123.317,-96.05,-115.767,-113.65,-99.95,-101.067,-113.383,-79.423,-104.2,-114.47,-113.35,-78.15000000000001,-111.733,-125.767,-66.65000000000001,-125.767,-107.133,-109.133,-57.617,-69.55,-73.90000000000001,-111.9,-121.583,-62.583,-130.35,-114.483,-94.65000000000001,-71.81699999999999,-90.467,-74.77,-115.117,-110.073,-111.917,-57.583,-57.033,-123.167,-77.31699999999999,-113.854,-82.56699999999999,-63.509,-58.55,-123.183,-64.40000000000001,-65.45,-78.167,-111.467,-82.967,-93.577,-92.733,-135.868,-76.59999999999999,-123.167,-137.583,-90.217],null,null,null,{"interactive":true,"draggable":false,"keyboard":true,"title":"","alt":"","zIndexOffset":0,"opacity":1,"riseOnHover":false,"riseOffset":250},["KESSLER AGCM","WAWA","TUKTUT NOGAIT  NWT","HOLBERG  B. C.","STETTLER AGDM  ALTA","JOHNSON POINT","ERIEAU (AUT)  ONT","HANBURY RIVER  NWT","CLEARDALE AGDM  ALTA","HALDANE RIVER","FRELIGHSBURG  QUE","ST ANICET 1  QUE","EUREKA","INNER WHALEBACKS  NWT","ISLAND LAKE AIRPORT","ROCKGLEN (AUT)  SASK","LAKE WINNIPEG S. BASIN","IRVINE AGCM","ILE AUX PERROQUETS  QUE","LAKE ST CLAIR","ROWLEY ISLAND","WEST DIXON ENTRANCE","BONILLA ISLAND    &","ELK ISLAND NAT PARK  ALTA","PINE ISLAND (MAPS)","GUELPH TURFGRASS","WEKWEETI","ANDREW AGDM  ALTA","LANGARA","PEMBERTON AIRPORT  BC","SANDSPIT AIRPORT","TROIS RIVIERES  QUE","PEAWANUCK (AUT)","FORT PROVIDENCE","BEARTOOTH ISLAND","HOLBERG","L'ARTIFICE","BELLSHILL AGCM","SAINT ANTHONY","BATHURST ISLAND   &","PINCHER CREEK CLIMATE","CHEVERY  QUE","ROCKGLEN (MARS)","MELITA  MAN","SWIFT CURRENT CDA  SASK","KENORA RCS","VICTORIA (AUTO8)","PINAWA  MAN","HAY RIVER AIRPORT","LINDEN AGCM","BRANDON AIRPORT","LYNN LAKE AIRPORT","ATHABASCA AGCM","NORTH BAY","WYNYARD (AUT)  SASK","LEEDALE AGDM","OLIVER AGDM  ALTA","AKULIVIK AIRPORT","GRASSY LAKE","TOFINO","CAP CHAT  QUE","MUNCHO LAKE","CREE LAKE (MAPS)","LOON LAKE","BURGEO NL","RIVIERE DU LOUP   &","BEAUHARNOIS","BROOKS","LYTTON","SAGLEK","HOLLAND ROCK  BC","CROWSNEST  ALTA","ISLAND LAKE AIRPORT","LENOXVILLE  QUE","UPSALA (AUT)  ONT","MT ARTHUR (AUT)","VIOLET GROVE CS  ALTA","LLOYDMINSTER","FORT SMITH CLIMATE  NWT","DANIELS HARBOUR   NFLD","CARTWRIGHT","SQUAMISH (AUTO8)","PETAWAWA A ONT","EDMONTON VILLENEUVE","GORE BAY CLIMATE","HALIFAX INTL","STEPHENVILLE ARPT","VANCOUVER SEA ISLAND CCG","PUINTE CLAVEAU","CHATHAM","COBOURG (AUT)  ONT","CORONATION (AUT)","GREAT DUCK ISLAND","TALOYOAK","DRYDEN RGNL","MAYO","KINGSTON CLIMATE","VANCOUVER INTL","HAINES JUNCTION","PICKLE LAKE"],null,null,null,["KESSLER AGCM","WAWA","TUKTUT NOGAIT  NWT","HOLBERG  B. C.","STETTLER AGDM  ALTA","JOHNSON POINT","ERIEAU (AUT)  ONT","HANBURY RIVER  NWT","CLEARDALE AGDM  ALTA","HALDANE RIVER","FRELIGHSBURG  QUE","ST ANICET 1  QUE","EUREKA","INNER WHALEBACKS  NWT","ISLAND LAKE AIRPORT","ROCKGLEN (AUT)  SASK","LAKE WINNIPEG S. BASIN","IRVINE AGCM","ILE AUX PERROQUETS  QUE","LAKE ST CLAIR","ROWLEY ISLAND","WEST DIXON ENTRANCE","BONILLA ISLAND    &amp;","ELK ISLAND NAT PARK  ALTA","PINE ISLAND (MAPS)","GUELPH TURFGRASS","WEKWEETI","ANDREW AGDM  ALTA","LANGARA","PEMBERTON AIRPORT  BC","SANDSPIT AIRPORT","TROIS RIVIERES  QUE","PEAWANUCK (AUT)","FORT PROVIDENCE","BEARTOOTH ISLAND","HOLBERG","L'ARTIFICE","BELLSHILL AGCM","SAINT ANTHONY","BATHURST ISLAND   &amp;","PINCHER CREEK CLIMATE","CHEVERY  QUE","ROCKGLEN (MARS)","MELITA  MAN","SWIFT CURRENT CDA  SASK","KENORA RCS","VICTORIA (AUTO8)","PINAWA  MAN","HAY RIVER AIRPORT","LINDEN AGCM","BRANDON AIRPORT","LYNN LAKE AIRPORT","ATHABASCA AGCM","NORTH BAY","WYNYARD (AUT)  SASK","LEEDALE AGDM","OLIVER AGDM  ALTA","AKULIVIK AIRPORT","GRASSY LAKE","TOFINO","CAP CHAT  QUE","MUNCHO LAKE","CREE LAKE (MAPS)","LOON LAKE","BURGEO NL","RIVIERE DU LOUP   &amp;","BEAUHARNOIS","BROOKS","LYTTON","SAGLEK","HOLLAND ROCK  BC","CROWSNEST  ALTA","ISLAND LAKE AIRPORT","LENOXVILLE  QUE","UPSALA (AUT)  ONT","MT ARTHUR (AUT)","VIOLET GROVE CS  ALTA","LLOYDMINSTER","FORT SMITH CLIMATE  NWT","DANIELS HARBOUR   NFLD","CARTWRIGHT","SQUAMISH (AUTO8)","PETAWAWA A ONT","EDMONTON VILLENEUVE","GORE BAY CLIMATE","HALIFAX INTL","STEPHENVILLE ARPT","VANCOUVER SEA ISLAND CCG","PUINTE CLAVEAU","CHATHAM","COBOURG (AUT)  ONT","CORONATION (AUT)","GREAT DUCK ISLAND","TALOYOAK","DRYDEN RGNL","MAYO","KINGSTON CLIMATE","VANCOUVER INTL","HAINES JUNCTION","PICKLE LAKE"],{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]}],"limits":{"lat":[42.25,81.33],"lng":[-137.583,-55.633]}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p>Obs: I’m sampling randomly only 100 weather stations so the map is lighter, but there are around 2K stations in Canada alone. 🤯</p>
<p>Another important function of this package is <code>nearest_stations</code>, which allows to find the nearest stations based on the geographical coordinates you provide. For instance, when looking up Toronto’s Downtown coordinates, we see a few stations nearby:</p>
<div class="cell">
<details open="" class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb3"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="op">(</span><span class="va">nearby_stations</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/GSODR/man/nearest_stations.html">nearest_stations</a></span><span class="op">(</span>LAT <span class="op">=</span> <span class="fl">43.653</span>,LON <span class="op">=</span> <span class="op">-</span><span class="fl">79.384</span>,</span>
<span>                                    distance <span class="op">=</span> <span class="fl">10</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="va">STNID</span>,<span class="va">NAME</span>,<span class="va">LAT</span>,<span class="va">LON</span>,<span class="va">COUNTRY_NAME</span>,<span class="va">distance_km</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu">gt</span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div>
<div id="zhmpciexmh" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#zhmpciexmh table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#zhmpciexmh thead, #zhmpciexmh tbody, #zhmpciexmh tfoot, #zhmpciexmh tr, #zhmpciexmh td, #zhmpciexmh th {
  border-style: none;
}

#zhmpciexmh p {
  margin: 0;
  padding: 0;
}

#zhmpciexmh .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#zhmpciexmh .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#zhmpciexmh .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#zhmpciexmh .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#zhmpciexmh .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#zhmpciexmh .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#zhmpciexmh .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#zhmpciexmh .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#zhmpciexmh .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#zhmpciexmh .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#zhmpciexmh .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#zhmpciexmh .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#zhmpciexmh .gt_spanner_row {
  border-bottom-style: hidden;
}

#zhmpciexmh .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#zhmpciexmh .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#zhmpciexmh .gt_from_md > :first-child {
  margin-top: 0;
}

#zhmpciexmh .gt_from_md > :last-child {
  margin-bottom: 0;
}

#zhmpciexmh .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#zhmpciexmh .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#zhmpciexmh .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#zhmpciexmh .gt_row_group_first td {
  border-top-width: 2px;
}

#zhmpciexmh .gt_row_group_first th {
  border-top-width: 2px;
}

#zhmpciexmh .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#zhmpciexmh .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#zhmpciexmh .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#zhmpciexmh .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#zhmpciexmh .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#zhmpciexmh .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#zhmpciexmh .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#zhmpciexmh .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#zhmpciexmh .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#zhmpciexmh .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#zhmpciexmh .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#zhmpciexmh .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#zhmpciexmh .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#zhmpciexmh .gt_left {
  text-align: left;
}

#zhmpciexmh .gt_center {
  text-align: center;
}

#zhmpciexmh .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#zhmpciexmh .gt_font_normal {
  font-weight: normal;
}

#zhmpciexmh .gt_font_bold {
  font-weight: bold;
}

#zhmpciexmh .gt_font_italic {
  font-style: italic;
}

#zhmpciexmh .gt_super {
  font-size: 65%;
}

#zhmpciexmh .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#zhmpciexmh .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#zhmpciexmh .gt_indent_1 {
  text-indent: 5px;
}

#zhmpciexmh .gt_indent_2 {
  text-indent: 10px;
}

#zhmpciexmh .gt_indent_3 {
  text-indent: 15px;
}

#zhmpciexmh .gt_indent_4 {
  text-indent: 20px;
}

#zhmpciexmh .gt_indent_5 {
  text-indent: 25px;
}
</style>
<table class="gt_table table table-sm table-striped small" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead><tr class="header gt_col_headings">
<th id="STNID" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">STNID</th>
<th id="NAME" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col">NAME</th>
<th id="LAT" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">LAT</th>
<th id="LON" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">LON</th>
<th id="COUNTRY_NAME" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col">COUNTRY_NAME</th>
<th id="distance_km" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">distance_km</th>
</tr></thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_right" headers="STNID">715080-99999</td>
<td class="gt_row gt_left" headers="NAME">TORONTO CITY ONT</td>
<td class="gt_row gt_right" headers="LAT">43.667</td>
<td class="gt_row gt_right" headers="LON">-79.400</td>
<td class="gt_row gt_left" headers="COUNTRY_NAME">CANADA</td>
<td class="gt_row gt_right" headers="distance_km">2.0</td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers="STNID">712654-99999</td>
<td class="gt_row gt_left" headers="NAME">TORONTO ISL (MARS)</td>
<td class="gt_row gt_right" headers="LAT">43.633</td>
<td class="gt_row gt_right" headers="LON">-79.400</td>
<td class="gt_row gt_left" headers="COUNTRY_NAME">CANADA</td>
<td class="gt_row gt_right" headers="distance_km">2.6</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="STNID">726247-99999</td>
<td class="gt_row gt_left" headers="NAME">TORONTO IL ARPT AUT</td>
<td class="gt_row gt_right" headers="LAT">43.633</td>
<td class="gt_row gt_right" headers="LON">-79.400</td>
<td class="gt_row gt_left" headers="COUNTRY_NAME">CANADA</td>
<td class="gt_row gt_right" headers="distance_km">2.6</td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers="STNID">712650-99999</td>
<td class="gt_row gt_left" headers="NAME">TORONTO CITY CENTRE</td>
<td class="gt_row gt_right" headers="LAT">43.617</td>
<td class="gt_row gt_right" headers="LON">-79.383</td>
<td class="gt_row gt_left" headers="COUNTRY_NAME">CANADA</td>
<td class="gt_row gt_right" headers="distance_km">4.0</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<details open="" class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb4"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">leaflet</span><span class="op">(</span>data <span class="op">=</span> <span class="va">nearby_stations</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu">addTiles</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">addMarkers</span><span class="op">(</span><span class="op">~</span><span class="va">LON</span>, <span class="op">~</span><span class="va">LAT</span>, popup <span class="op">=</span> <span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="va">NAME</span><span class="op">)</span>, label <span class="op">=</span> <span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="va">NAME</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div class="leaflet html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-6ce74f2af526ef520d31" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-6ce74f2af526ef520d31">{"x":{"options":{"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}}},"calls":[{"method":"addTiles","args":["https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",null,null,{"minZoom":0,"maxZoom":18,"tileSize":256,"subdomains":"abc","errorTileUrl":"","tms":false,"noWrap":false,"zoomOffset":0,"zoomReverse":false,"opacity":1,"zIndex":1,"detectRetina":false,"attribution":"&copy; <a href=\"https://openstreetmap.org/copyright/\">OpenStreetMap<\/a>,  <a href=\"https://opendatacommons.org/licenses/odbl/\">ODbL<\/a>"}]},{"method":"addMarkers","args":[[43.667,43.633,43.633,43.617],[-79.40000000000001,-79.40000000000001,-79.40000000000001,-79.383],null,null,null,{"interactive":true,"draggable":false,"keyboard":true,"title":"","alt":"","zIndexOffset":0,"opacity":1,"riseOnHover":false,"riseOffset":250},["TORONTO CITY  ONT","TORONTO ISL (MARS)","TORONTO IL ARPT AUT","TORONTO CITY CENTRE"],null,null,null,["TORONTO CITY  ONT","TORONTO ISL (MARS)","TORONTO IL ARPT AUT","TORONTO CITY CENTRE"],{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]}],"limits":{"lat":[43.617,43.667],"lng":[-79.40000000000001,-79.383]}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p>When you’re finished choosing one or multiple stations, the next step is obtaining the actual data for them:</p>
<div class="cell">
<details open="" class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb5"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="op">(</span><span class="va">weather_data</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/GSODR/man/get_GSOD.html">get_GSOD</a></span><span class="op">(</span>years <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2020</span><span class="op">:</span><span class="fl">2024</span><span class="op">)</span>, station <span class="op">=</span> <span class="st">"712650-99999"</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>   <span class="fu">select</span><span class="op">(</span><span class="va">STNID</span>,<span class="va">NAME</span>,<span class="va">MONTH</span>,<span class="va">DAY</span>,<span class="va">YEAR</span>,<span class="va">TEMP</span>,<span class="va">MAX</span>,<span class="va">MIN</span>,<span class="va">RH</span>, <span class="va">I_FOG</span> ,<span class="va">SLP</span>,<span class="va">WDSP</span>,<span class="va">PRCP</span>,DATE <span class="op">=</span> <span class="va">YEARMODA</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html">tail</a></span><span class="op">(</span><span class="fl">5</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu">gt</span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div>
<div id="pkvgpsnrhq" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#pkvgpsnrhq table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#pkvgpsnrhq thead, #pkvgpsnrhq tbody, #pkvgpsnrhq tfoot, #pkvgpsnrhq tr, #pkvgpsnrhq td, #pkvgpsnrhq th {
  border-style: none;
}

#pkvgpsnrhq p {
  margin: 0;
  padding: 0;
}

#pkvgpsnrhq .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#pkvgpsnrhq .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#pkvgpsnrhq .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#pkvgpsnrhq .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#pkvgpsnrhq .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#pkvgpsnrhq .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#pkvgpsnrhq .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#pkvgpsnrhq .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#pkvgpsnrhq .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#pkvgpsnrhq .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#pkvgpsnrhq .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#pkvgpsnrhq .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#pkvgpsnrhq .gt_spanner_row {
  border-bottom-style: hidden;
}

#pkvgpsnrhq .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#pkvgpsnrhq .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#pkvgpsnrhq .gt_from_md > :first-child {
  margin-top: 0;
}

#pkvgpsnrhq .gt_from_md > :last-child {
  margin-bottom: 0;
}

#pkvgpsnrhq .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#pkvgpsnrhq .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#pkvgpsnrhq .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#pkvgpsnrhq .gt_row_group_first td {
  border-top-width: 2px;
}

#pkvgpsnrhq .gt_row_group_first th {
  border-top-width: 2px;
}

#pkvgpsnrhq .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#pkvgpsnrhq .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#pkvgpsnrhq .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#pkvgpsnrhq .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#pkvgpsnrhq .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#pkvgpsnrhq .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#pkvgpsnrhq .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#pkvgpsnrhq .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#pkvgpsnrhq .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#pkvgpsnrhq .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#pkvgpsnrhq .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#pkvgpsnrhq .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#pkvgpsnrhq .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#pkvgpsnrhq .gt_left {
  text-align: left;
}

#pkvgpsnrhq .gt_center {
  text-align: center;
}

#pkvgpsnrhq .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#pkvgpsnrhq .gt_font_normal {
  font-weight: normal;
}

#pkvgpsnrhq .gt_font_bold {
  font-weight: bold;
}

#pkvgpsnrhq .gt_font_italic {
  font-style: italic;
}

#pkvgpsnrhq .gt_super {
  font-size: 65%;
}

#pkvgpsnrhq .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#pkvgpsnrhq .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#pkvgpsnrhq .gt_indent_1 {
  text-indent: 5px;
}

#pkvgpsnrhq .gt_indent_2 {
  text-indent: 10px;
}

#pkvgpsnrhq .gt_indent_3 {
  text-indent: 15px;
}

#pkvgpsnrhq .gt_indent_4 {
  text-indent: 20px;
}

#pkvgpsnrhq .gt_indent_5 {
  text-indent: 25px;
}
</style>
<table class="gt_table table table-sm table-striped small" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead><tr class="header gt_col_headings">
<th id="STNID" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">STNID</th>
<th id="NAME" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col">NAME</th>
<th id="MONTH" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">MONTH</th>
<th id="DAY" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">DAY</th>
<th id="YEAR" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">YEAR</th>
<th id="TEMP" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">TEMP</th>
<th id="MAX" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">MAX</th>
<th id="MIN" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">MIN</th>
<th id="RH" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">RH</th>
<th id="I_FOG" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">I_FOG</th>
<th id="SLP" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">SLP</th>
<th id="WDSP" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">WDSP</th>
<th id="PRCP" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">PRCP</th>
<th id="DATE" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">DATE</th>
</tr></thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_right" headers="STNID">712650-99999</td>
<td class="gt_row gt_left" headers="NAME">TORONTO CITY CENTRE</td>
<td class="gt_row gt_right" headers="MONTH">5</td>
<td class="gt_row gt_right" headers="DAY">8</td>
<td class="gt_row gt_right" headers="YEAR">2024</td>
<td class="gt_row gt_right" headers="TEMP">14.7</td>
<td class="gt_row gt_right" headers="MAX">21.6</td>
<td class="gt_row gt_right" headers="MIN">7.1</td>
<td class="gt_row gt_right" headers="RH">65.5</td>
<td class="gt_row gt_right" headers="I_FOG">1</td>
<td class="gt_row gt_right" headers="SLP">1001.8</td>
<td class="gt_row gt_right" headers="WDSP">7.5</td>
<td class="gt_row gt_right" headers="PRCP">5.08</td>
<td class="gt_row gt_right" headers="DATE">2024-05-08</td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers="STNID">712650-99999</td>
<td class="gt_row gt_left" headers="NAME">TORONTO CITY CENTRE</td>
<td class="gt_row gt_right" headers="MONTH">5</td>
<td class="gt_row gt_right" headers="DAY">9</td>
<td class="gt_row gt_right" headers="YEAR">2024</td>
<td class="gt_row gt_right" headers="TEMP">12.3</td>
<td class="gt_row gt_right" headers="MAX">21.6</td>
<td class="gt_row gt_right" headers="MIN">9.2</td>
<td class="gt_row gt_right" headers="RH">71.5</td>
<td class="gt_row gt_right" headers="I_FOG">0</td>
<td class="gt_row gt_right" headers="SLP">1009.9</td>
<td class="gt_row gt_right" headers="WDSP">3.1</td>
<td class="gt_row gt_right" headers="PRCP">0.00</td>
<td class="gt_row gt_right" headers="DATE">2024-05-09</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="STNID">712650-99999</td>
<td class="gt_row gt_left" headers="NAME">TORONTO CITY CENTRE</td>
<td class="gt_row gt_right" headers="MONTH">5</td>
<td class="gt_row gt_right" headers="DAY">10</td>
<td class="gt_row gt_right" headers="YEAR">2024</td>
<td class="gt_row gt_right" headers="TEMP">13.2</td>
<td class="gt_row gt_right" headers="MAX">14.6</td>
<td class="gt_row gt_right" headers="MIN">9.2</td>
<td class="gt_row gt_right" headers="RH">59.2</td>
<td class="gt_row gt_right" headers="I_FOG">0</td>
<td class="gt_row gt_right" headers="SLP">1009.4</td>
<td class="gt_row gt_right" headers="WDSP">3.6</td>
<td class="gt_row gt_right" headers="PRCP">0.00</td>
<td class="gt_row gt_right" headers="DATE">2024-05-10</td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers="STNID">712650-99999</td>
<td class="gt_row gt_left" headers="NAME">TORONTO CITY CENTRE</td>
<td class="gt_row gt_right" headers="MONTH">5</td>
<td class="gt_row gt_right" headers="DAY">11</td>
<td class="gt_row gt_right" headers="YEAR">2024</td>
<td class="gt_row gt_right" headers="TEMP">10.9</td>
<td class="gt_row gt_right" headers="MAX">13.0</td>
<td class="gt_row gt_right" headers="MIN">8.0</td>
<td class="gt_row gt_right" headers="RH">80.1</td>
<td class="gt_row gt_right" headers="I_FOG">1</td>
<td class="gt_row gt_right" headers="SLP">1007.4</td>
<td class="gt_row gt_right" headers="WDSP">3.0</td>
<td class="gt_row gt_right" headers="PRCP">0.00</td>
<td class="gt_row gt_right" headers="DATE">2024-05-11</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="STNID">712650-99999</td>
<td class="gt_row gt_left" headers="NAME">TORONTO CITY CENTRE</td>
<td class="gt_row gt_right" headers="MONTH">5</td>
<td class="gt_row gt_right" headers="DAY">12</td>
<td class="gt_row gt_right" headers="YEAR">2024</td>
<td class="gt_row gt_right" headers="TEMP">11.9</td>
<td class="gt_row gt_right" headers="MAX">17.5</td>
<td class="gt_row gt_right" headers="MIN">8.2</td>
<td class="gt_row gt_right" headers="RH">81.3</td>
<td class="gt_row gt_right" headers="I_FOG">1</td>
<td class="gt_row gt_right" headers="SLP">1008.5</td>
<td class="gt_row gt_right" headers="WDSP">4.4</td>
<td class="gt_row gt_right" headers="PRCP">1.78</td>
<td class="gt_row gt_right" headers="DATE">2024-05-12</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<p>TIP: You can also get data for multiple years and/or multiple stations at once.</p>
</section><section id="plots" class="level2"><h2 class="anchored" data-anchor-id="plots">Plots</h2>
<p>Having gotten the data, there are tons of interesting things to plot. I’ll show you some examples, feel free to get inspire and create even better looking plots :)</p>
<section id="example-1-temperature-as-lines" class="level3"><h3 class="anchored" data-anchor-id="example-1-temperature-as-lines">Example 1: Temperature as lines</h3>
<p>Here, I’m plotting Maximum (red) and Minimum temperatures each day for over 2 years of Toronto weather data, which we’ve obtained in the previous step.</p>
<p>There is also quite some customization going on, such as:</p>
<ul>
<li>Smooth line for the two series (minimum and maximum)</li>
<li>Changing size of fonts</li>
<li>Disabling legend</li>
<li>Changing color palette to use colors widely identifiable as “cold” and “heat”</li>
</ul>
<p>TIP: As many other ggplot2 situations, it’s a good practice to transform your data to “long format” using pivot_longer to transform it to name/value pairs.<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a></p>
<div class="cell">
<details open="" class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb6"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="va">temperatures</span>, <span class="fu">aes</span><span class="op">(</span>x<span class="op">=</span><span class="va">DATE</span>, y<span class="op">=</span><span class="va">value</span>, color<span class="op">=</span><span class="va">temp</span>, linetype<span class="op">=</span><span class="va">temp</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">geom_point</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">scale_colour_brewer</span><span class="op">(</span>palette<span class="op">=</span><span class="st">"Set1"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_smooth</span><span class="op">(</span>span <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggtitle</span><span class="op">(</span><span class="st">"Toronto City Centre daily Min. and Max. Temperatures (2022-2024)"</span><span class="op">)</span> <span class="op">+</span>   </span>
<span>  <span class="fu">theme</span><span class="op">(</span>plot.title<span class="op">=</span><span class="fu">element_text</span><span class="op">(</span>size<span class="op">=</span><span class="fl">18</span>, face<span class="op">=</span><span class="st">"bold"</span><span class="op">)</span>,</span>
<span>        axis.title.y<span class="op">=</span><span class="fu">element_text</span><span class="op">(</span>size<span class="op">=</span><span class="fl">15</span><span class="op">)</span>,legend.position <span class="op">=</span> <span class="st">"None"</span>,</span>
<span>        legend.text<span class="op">=</span><span class="fu">element_text</span><span class="op">(</span>size<span class="op">=</span><span class="fl">13</span><span class="op">)</span>,</span>
<span>        axis.title.x<span class="op">=</span><span class="fu">element_text</span><span class="op">(</span>size<span class="op">=</span><span class="fl">16</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span><span class="cn">NULL</span>, y<span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"Temperature ("</span>,<span class="va">degree</span>,<span class="st">"C)"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">+</span><span class="fu">theme_few</span><span class="op">(</span><span class="op">)</span> <span class="co">#scale_y_continuous(limits=c(-30, 50)) + scale_x_continuous(limits=c(0, 200)) </span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div>
<figure class="figure"><p><img src="weather_data_r_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid figure-img" width="1344"></p>
</figure>
</div>
</div>
</div>
</section><section id="example-2-rainy-days-by-season" class="level3"><h3 class="anchored" data-anchor-id="example-2-rainy-days-by-season">Example 2: Rainy Days By Season</h3>
<p>With this plot, I wanted to see the difference in the number of rainy days from one season to another. It should be interesting also to compare this aspect for different regions that have dry/wet seasons in different parts of the year. The first roadblock here was: how to define what is a season based on the dates, since weather seasons change in different days of the month and you also have to break months in parts. For that purpose, I’ve borrowed a function I had seen on Stack Overflow and made some concessions to get to a quicker solution setting season change dates always on the 21th, for the sake of simplicity. 😆</p>
<div class="cell">
<details class="code-fold"><summary>Show the code</summary><div class="sourceCode" id="cb7"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">weather_data</span><span class="op">$</span><span class="va">rained</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">weather_data</span><span class="op">$</span><span class="va">PRCP</span> <span class="op">==</span> <span class="fl">0</span> <span class="op">|</span> <span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">weather_data</span><span class="op">$</span><span class="va">PRCP</span><span class="op">)</span>,<span class="st">"No Rain"</span>,<span class="st">"Rain"</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#Based on the code obtained from:</span></span>
<span><span class="co">#https://stackoverflow.com/questions/9500114/find-which-season-a-particular-date-belongs-to</span></span>
<span><span class="va">toSeason</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">dat</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/stopifnot.html">stopifnot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/class.html">class</a></span><span class="op">(</span><span class="va">dat</span><span class="op">)</span> <span class="op">==</span> <span class="st">"Date"</span><span class="op">)</span></span>
<span>  <span class="va">scalarCheck</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">dat</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">m</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.POSIXlt.html">as.POSIXlt</a></span><span class="op">(</span><span class="va">dat</span><span class="op">)</span><span class="op">$</span><span class="va">mon</span><span class="op">+</span> <span class="fl">1</span>        <span class="co"># correct for 0:11 range</span></span>
<span>    <span class="va">d</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.POSIXlt.html">as.POSIXlt</a></span><span class="op">(</span><span class="va">dat</span><span class="op">)</span><span class="op">$</span><span class="va">mday</span>           <span class="co"># correct for 0:11 range</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="op">(</span><span class="va">m</span> <span class="op">==</span> <span class="fl">3</span> <span class="op">&amp;</span> <span class="va">d</span> <span class="op">&gt;=</span> <span class="fl">21</span><span class="op">)</span> <span class="op">|</span> <span class="op">(</span><span class="va">m</span> <span class="op">==</span> <span class="fl">4</span><span class="op">)</span> <span class="op">|</span> <span class="op">(</span><span class="va">m</span> <span class="op">==</span> <span class="fl">5</span><span class="op">)</span> <span class="op">|</span> <span class="op">(</span><span class="va">m</span> <span class="op">==</span> <span class="fl">6</span> <span class="op">&amp;</span> <span class="va">d</span> <span class="op">&lt;</span> <span class="fl">21</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">r</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span>    <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="op">(</span><span class="va">m</span> <span class="op">==</span> <span class="fl">6</span> <span class="op">&amp;</span> <span class="va">d</span> <span class="op">&gt;=</span> <span class="fl">21</span><span class="op">)</span> <span class="op">|</span> <span class="op">(</span><span class="va">m</span> <span class="op">==</span> <span class="fl">7</span><span class="op">)</span> <span class="op">|</span> <span class="op">(</span><span class="va">m</span> <span class="op">==</span> <span class="fl">8</span><span class="op">)</span> <span class="op">|</span> <span class="op">(</span><span class="va">m</span> <span class="op">==</span> <span class="fl">9</span> <span class="op">&amp;</span> <span class="va">d</span> <span class="op">&lt;</span> <span class="fl">21</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">r</span> <span class="op">&lt;-</span> <span class="fl">2</span></span>
<span>    <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="op">(</span><span class="va">m</span> <span class="op">==</span> <span class="fl">9</span> <span class="op">&amp;</span> <span class="va">d</span> <span class="op">&gt;=</span> <span class="fl">21</span><span class="op">)</span> <span class="op">|</span> <span class="op">(</span><span class="va">m</span> <span class="op">==</span> <span class="fl">10</span><span class="op">)</span> <span class="op">|</span> <span class="op">(</span><span class="va">m</span> <span class="op">==</span> <span class="fl">11</span><span class="op">)</span> <span class="op">|</span> <span class="op">(</span><span class="va">m</span> <span class="op">==</span> <span class="fl">12</span> <span class="op">&amp;</span> <span class="va">d</span> <span class="op">&lt;</span> <span class="fl">21</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">r</span> <span class="op">&lt;-</span> <span class="fl">3</span></span>
<span>    <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>      <span class="va">r</span> <span class="op">&lt;-</span> <span class="fl">4</span></span>
<span>    <span class="op">}</span></span>
<span>    <span class="va">r</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span><span class="op">(</span><span class="va">dat</span>, <span class="va">scalarCheck</span><span class="op">)</span></span>
<span>  <span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">ordered</a></span><span class="op">(</span><span class="va">res</span>, labels<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Spring"</span>, <span class="st">"Summer"</span>, <span class="st">"Fall"</span>, <span class="st">"Winter"</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/invisible.html">invisible</a></span><span class="op">(</span><span class="va">res</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="va">weather_data</span><span class="op">$</span><span class="va">season</span> <span class="op">=</span> <span class="fu">toSeason</span><span class="op">(</span><span class="va">weather_data</span><span class="op">$</span><span class="va">DATE</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Having done that, we can then plot a 100% stacked bar chart of each Season and on how many days it rained for each one. As you can see for this particular case, Season were more homogeneous in terms of rain in Toronto in 2023.</p>
<div class="cell">
<details open="" class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb8"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">weather_data</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">YEAR</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2022</span>,<span class="fl">2023</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">season</span>,fill<span class="op">=</span><span class="va">rained</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_bar</span><span class="op">(</span> position<span class="op">=</span><span class="st">"fill"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">stat_count</span><span class="op">(</span>geom <span class="op">=</span> <span class="st">"text"</span>, </span>
<span>             <span class="fu">aes</span><span class="op">(</span>label <span class="op">=</span> <span class="va">..count..</span><span class="op">)</span>,</span>
<span>             position<span class="op">=</span><span class="fu">position_fill</span><span class="op">(</span>vjust<span class="op">=</span><span class="fl">0.5</span><span class="op">)</span>, colour<span class="op">=</span><span class="st">"black"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">scale_fill_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"#EDEFBD"</span>,<span class="st">"#ACD1E9"</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">ggtitle</span><span class="op">(</span><span class="st">"Rainy Days in Toronto, by Season (2022 and 2023)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>fill <span class="op">=</span> <span class="cn">NULL</span>, x<span class="op">=</span><span class="cn">NULL</span>, y<span class="op">=</span><span class="st">"% of days"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">scale_y_continuous</span><span class="op">(</span>labels <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/scales/man/percent_format.html">percent_format</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">facet_grid</span><span class="op">(</span><span class="op">~</span><span class="va">YEAR</span><span class="op">)</span><span class="op">+</span><span class="fu">theme_few</span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div>
<figure class="figure"><p><img src="weather_data_r_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid figure-img" width="1344"></p>
</figure>
</div>
</div>
</div>
</section><section id="example-3-horizon-plots-to-visualize-temperature-changes-over-the-years" class="level3"><h3 class="anchored" data-anchor-id="example-3-horizon-plots-to-visualize-temperature-changes-over-the-years">Example 3: Horizon Plots to visualize temperature changes over the years</h3>
<p>Okay, I can’t remember where I’ve seen this one, but I thought it was an ingenious way of plotting something like daily temperatures and I wanted to replicate it with my own data. Since it scales from the lowest to the highest temperature present in the data, it allows to see variations in temperature across many years. As you will probably agree, it seems that 2023 in Toronto had milder temperatures both in the Winter and in the Summer with much less prominent spikes over the entire year.</p>
<p>Credits to <a href="https://rivasiker.github.io/ggHoriPlot/articles/examples.html">ggHoriPlot’s vignette</a> which had some great examples that I borrowed from.</p>
<div class="cell">
<details class="code-fold"><summary>Show the code</summary><div class="sourceCode" id="cb9"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://rivasiker.github.io/ggHoriPlot/">ggHoriPlot</a></span><span class="op">)</span> </span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://jrnold.github.io/ggthemes/">ggthemes</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">cutpoints</span> <span class="op">=</span> <span class="va">weather_data</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span></span>
<span>    outlier <span class="op">=</span> <span class="fu">between</span><span class="op">(</span></span>
<span>      <span class="va">TEMP</span>, </span>
<span>      <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span><span class="op">(</span><span class="va">weather_data</span><span class="op">$</span><span class="va">TEMP</span>, <span class="fl">0.25</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span><span class="op">-</span></span>
<span>        <span class="fl">1.5</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/stats/IQR.html">IQR</a></span><span class="op">(</span><span class="va">weather_data</span><span class="op">$</span><span class="va">TEMP</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span>,</span>
<span>      <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span><span class="op">(</span><span class="va">weather_data</span><span class="op">$</span><span class="va">TEMP</span>, <span class="fl">0.75</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span><span class="op">+</span></span>
<span>        <span class="fl">1.5</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/stats/IQR.html">IQR</a></span><span class="op">(</span><span class="va">weather_data</span><span class="op">$</span><span class="va">TEMP</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">outlier</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ori</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/range.html">range</a></span><span class="op">(</span><span class="va">cutpoints</span><span class="op">$</span><span class="va">TEMP</span><span class="op">)</span><span class="op">)</span><span class="op">/</span><span class="fl">2</span></span>
<span><span class="va">sca</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/range.html">range</a></span><span class="op">(</span><span class="va">cutpoints</span><span class="op">$</span><span class="va">TEMP</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, </span>
<span>           <span class="fu"><a href="https://rdrr.io/r/base/range.html">range</a></span><span class="op">(</span><span class="va">cutpoints</span><span class="op">$</span><span class="va">TEMP</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, </span>
<span>           length.out <span class="op">=</span> <span class="fl">7</span><span class="op">)</span><span class="op">[</span><span class="op">-</span><span class="fl">4</span><span class="op">]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell preview-image">
<details open="" class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb10"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">weather_data</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">YEAR</span> <span class="op">&lt;</span><span class="fl">2024</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>date_mine <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="fu">str_glue</span><span class="op">(</span><span class="st">"2024-{MONTH}-{DAY}"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>  <span class="co">#constant date, just to assemble one year on top of the other</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/ggplot.html">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/ggHoriPlot/man/geom_horizon.html">geom_horizon</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/aes.html">aes</a></span><span class="op">(</span><span class="va">date_mine</span>, </span>
<span>                   <span class="va">TEMP</span>,</span>
<span>                   fill <span class="op">=</span> <span class="va">..Cutpoints..</span><span class="op">)</span>, </span>
<span>               origin <span class="op">=</span> <span class="va">ori</span>, horizonscale <span class="op">=</span> <span class="va">sca</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/ggHoriPlot/man/scale_fill_hcl.html">scale_fill_hcl</a></span><span class="op">(</span>palette <span class="op">=</span> <span class="st">'RdBu'</span>, reverse <span class="op">=</span> <span class="cn">T</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/facet_grid.html">facet_grid</a></span><span class="op">(</span><span class="va">YEAR</span><span class="op">~</span><span class="va">.</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/ggthemes/man/theme_few.html">theme_few</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/scale_date.html">scale_x_date</a></span><span class="op">(</span>expand<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span>, </span>
<span>               date_breaks <span class="op">=</span> <span class="st">"1 month"</span>, </span>
<span>               date_labels <span class="op">=</span> <span class="st">"%b"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/labs.html">xlab</a></span><span class="op">(</span><span class="cn">NULL</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/theme.html">theme</a></span><span class="op">(</span></span>
<span>    panel.spacing.y<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/grid/unit.html">unit</a></span><span class="op">(</span><span class="fl">0</span>, <span class="st">"lines"</span><span class="op">)</span>,</span>
<span>    strip.text.y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/element.html">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">16</span>, angle <span class="op">=</span> <span class="fl">0</span>, hjust <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>,</span>
<span>    axis.text.y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    axis.title.y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    axis.ticks.y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    panel.border <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    legend.position <span class="op">=</span> <span class="st">"None"</span>,</span>
<span>    plot.title<span class="op">=</span><span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/element.html">element_text</a></span><span class="op">(</span>size<span class="op">=</span><span class="fl">20</span>, face<span class="op">=</span><span class="st">"bold"</span><span class="op">)</span>,</span>
<span>    axis.text.x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/element.html">element_text</a></span><span class="op">(</span>size<span class="op">=</span><span class="fl">16</span>,hjust<span class="op">=</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span><span class="st">'Daily Temperature in Toronto, Canada'</span>,x<span class="op">=</span><span class="cn">NULL</span>,subtitle<span class="op">=</span><span class="st">"The stronger the color, the more extreme the temperature"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div>
<figure class="figure"><p><img src="weather_data_r_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid figure-img" width="1344"></p>
</figure>
</div>
</div>
</div>


</section></section><div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>
<ol>
<li id="fn1"><p><a href="GSOD">https://www.ncei.noaa.gov/access/metadata/landing-page/bin/iso?id=gov.noaa.ncdc:C00516</a><a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p><a href="https://dcl-wrangle.stanford.edu/pivot-advanced.html" class="uri">https://dcl-wrangle.stanford.edu/pivot-advanced.html</a><a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol></section></div></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer"><div class="nav-footer">
    <div class="nav-footer-left">
<p>Made with <a href="https://quarto.org/">Quarto</a></p>
</div>   
    <div class="nav-footer-center">
<p><a href="mailto:rafabelokurows@gmail.com">Rafael Belokurows</a></p>
</div>
    <div class="nav-footer-right">
<p><a href="https://www.github.com/rafabelokurows/">Github</a></p>
</div>
  </div>
</footer>


</body></html>